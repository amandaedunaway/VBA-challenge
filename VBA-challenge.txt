'Attribute VB_Name = "Module1"

' Place cursor at beginning of Sub DoSomething to
' Run StockInfo sub routine on every sheet:
Sub Dosomething()
    Dim xSh As Worksheet
    Application.ScreenUpdating = False
    For Each xSh In Worksheets
        xSh.Select
        Call StockInfo
    Next
    Application.ScreenUpdating = True
End Sub



' Subroutine to pull designated numbers and perform calculations:
Sub StockInfo():


Dim i As Long
Dim LastRow As Long
Dim OpenP As Double
Dim CloseP As Double
Dim TotalVolume As Double
Dim CurrentTicker As String
Dim PercentChange As Double
Dim YearlyChange As Double
Dim DisplayRow As Integer
Dim LastK As Integer


    ' Column labels for first set of calculations:
    Range("I1") = "Ticker"
    Range("J1") = "Yearly Change"
    Range("K1") = "Percent Change"
    Range("L1") = "Total Stock Volume"
    
    
    ' Initial values and defining variables:
    LastRow = Cells(Rows.Count, 1).End(xlUp).Row
    OpenP = Cells(2, "C").Value
    TotalVolume = 0
    DisplayRow = 2
    
   
    
  
        ' For loop to find opening and closing prices for each ticker:
       For i = 2 To LastRow
       
       
        ' Cumulative Total volume for each ticker:
        TotalVolume = TotalVolume + Cells(i, "G").Value
        
        
            ' nested if function indicates when one ticker ends
            '   and the next begins:
            ' When we reach the end of a ticker, we assign the
            ' appropriate values and perform calculations:
           If Cells(i, "A").Value <> Cells(i + 1, "A").Value Then
                CurrentTicker = Cells(i, "A").Value
                CloseP = Cells(i, "F").Value
                YearlyChange = CloseP - OpenP
                PercentChange = ((CloseP - OpenP) / OpenP) * 100
                
                
                'Display the values we just allocated into the appropriate cells:
                Cells(DisplayRow, "I").Value = CurrentTicker
                Cells(DisplayRow, "J").Value = YearlyChange
                Cells(DisplayRow, "K").Value = PercentChange
                Cells(DisplayRow, "L").Value = TotalVolume
                
                
                ' set up for next ticker:
                DisplayRow = DisplayRow + 1
                OpenP = Cells(i + 1, "C").Value
                TotalVolume = 0
                
           End If
        
        Next i
        
        
  'Row lables for second set of calculations:
    Range("O2") = "Greatest % Increase"
    Range("O3") = "Greatest % Decrease"
    Range("O4") = "Greatest Total Volume"
    Range("P1") = "Ticker"
    Range("Q1") = "Value"
    
  'Search to find the greatest percent increases and decreases:
    Range("Q2") = WorksheetFunction.Max(Range("K2:K" & LastRow))
    Range("Q3") = WorksheetFunction.Min(Range("K2:K" & LastRow))
    Range("Q4") = WorksheetFunction.Max(Range("L2:L" & LastRow))
    
    '3001
    
   ' For loop that matches the min and max values found above to the ticker:
        For i = 2 To LastRow
        
            If Cells(i, "K").Value = Range("Q2") Then
                Range("P2") = Cells(i, "I").Value
                Else
            End If
            
            
            If Cells(i, "K").Value = Range("Q3") Then
                Range("P3") = Cells(i, "I").Value
                Else
            End If
            
            
            If Cells(i, "L").Value = Range("Q4") Then
                Range("P4") = Cells(i, "I").Value
                Else
            End If
            
        Next i
        
            
   'Color formatting:
    For i = 2 To LastRow
    
        If Cells(i, "J").Value < 0 Then
            Cells(i, "J").Interior.ColorIndex = 3
            Else
        End If
        
        
        If Cells(i, "J").Value > 0 Then
            Cells(i, "J").Interior.ColorIndex = 4
            Else
        End If
        
    Next i
    
  
    
      
End Sub



